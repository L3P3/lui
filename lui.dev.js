'use strict';/*
 lui.js web frame work 0.12.0
 inspired by react and mithril
 L3P3.de 2021
*/
{let d=null,g=!0,h=d,k=0,n=0,p=new Set,r=new Set,v=g,w=!g;
const C={},D={},E=d,F=g,G=w,H=Array,aa=Object,ba=aa.assign,I=aa.keys,ca=document,J=window,da=J.performance||Date,ea=({f:{h:a}})=>a===K?"list":a.name_||a.name||"?",fa=()=>{const a=[];let b=h;if(b!==E){for(;b[0][0]===E;)a.unshift(5===b[0].length?"hook_map:"+("object"===typeof b[0][3]?b[0][3].id:b[0][3]):"hook_sub"),b=b[0][1];b=b[0][0]}let c=E;for(;b!==E;)a.unshift(ea(b)+(c!==E?":"+c:"")),c=b.l,b=b.j;return a.join(">")||"-"},L=a=>{throw Error("lui: "+a);},M=(a,b)=>{a===b||a!==E&&b!==E&&JSON.stringify(I(a))===
JSON.stringify(I(b))||L("object keys mismatch")},N=(a,b)=>{h===E&&L("hook called outside of hook context");b&&null===h[0][0]&&L("hook called outside of component rendering");a!==E&&k<h.length&&h[k][0]!==a&&L("inconsistent hook order at #"+k)},P=(a,b)=>{N(E,G);a!==O(a,a)&&L(b+" changed between renderings")},ha=(a,b)=>(M(a,b),a===b?[]:I(a).filter(c=>a[c]!==b[c])),Q=(a,b)=>(M(a,b),a!==b&&I(a).some(c=>a[c]!==b[c])),K=(a,b)=>{b!==E?(0===b.length&&L("deps empty"),a.length!==b.length&&L("deps length changed")):
0<a.length&&L("deps presence changed");if(b!==E){let c=a.length;do if(a[--c]!==b[c])return G;while(0<c)}return F},R=(a,b)=>{const c=d,e=b;h=c.i;k=1;p.delete(c);if(c.f.h!==K){var f=E;try{f=c.f.h(c.f.g)}catch(B){if(B!==C)throw B;}var l=c.a;"object"!==typeof f&&L("components need to return child list or null");if(f!==E){l!==E&&(a=l,b=E);var m=f.length,t;"number"!==typeof m&&L("childs must be returned in a list");0===m&&L("returned childs list empty");c.b!==E&&m!==c.b.length&&L("returned childs count changed");
var y=c.b||(c.b=(new H(m)).fill(E));do{var q=y[--m];(t=f[m])&&t!==F?(q!==E&&q.f.h!==t.h&&L("child replaced at "+m),(g=q===E)?(y[m]=d=q={f:t,j:c,l:m,i:[],b:E,a:E,c:E},q.i[0]=[q],R(a,b),q.a!==E&&a.insertBefore(q.c=q.a,b)):Q(q.f.g,t.g)&&((d=q).f=t,R(a,b)),q.c!==E&&(b=q.c)):q!==E&&(S(q,a),y[m]=E)}while(0<m)}else if(c.b!==E){for(m of c.b)m!==E&&S(m,a);c.b=E}l===E&&(c.c=b!==e?b:E)}else{t=c.f.g.h;y=c.f.g.G;f=c.f.g.g;"object"===typeof y&&y!==E&&"number"===typeof y.length||L("list_data must be an array");
"object"!==typeof f&&L("props must be an object");P(t,"item component");P(f===E,"props presence");l=y.length;m={};q=[];y=0<l&&ia(y,m,q);0===l&&T();const B=T();var z=O(q),u=f===E?E:O(f);u=g||Q(f,u);if(!g)for(var A of z)A in m||(S(B[A],a),delete B[A]);for(A=c.b=new H(l);0<l;){z=q[--l];let x=B[z];if(g=void 0===x)B[z]=d=x={f:{h:t,g:f===E?{I:m[z]}:ba({I:m[z]},f)},j:c,l,i:[],b:E,a:E,c:E},x.i[0]=[x],R(a,b),x.a!==E&&a.insertBefore(x.c=x.a,b);else if(x.l!==l&&(ja(x,a,b),x.l=l),u||y&&Q(m[z],x.f.g.I))(d=x).f.g=
f===E?{I:m[z]}:ba({I:m[z]},f),R(a,b);(A[l]=x).c!==E&&(b=x.c)}c.c=b!==e?b:E}},S=(a,b)=>{b!==E&&a.a!==E&&(b.removeChild(a.a),b=E);if(a.b!==E)for(const c of a.b)c!==E&&S(c,b);U(a.i);p.delete(a);r.delete(a)},U=a=>{var b;let c=a.length;for(;1<c;)switch((b=a[--c])[0]){case 0:b[2]!==E&&b[2](b[1]);break;case 1:b[1]=E;break;case 9:U(b[4]);break;case 4:for(const e of b[4])U(b[6][e])}},ia=(a,b,c)=>{const e="object"===typeof a[0];var f=T();f.v?(a[0]!==E&&typeof a[0]===f.v||L("item type changed"),e&&typeof a[0].id!==
f.H&&L("item id type changed")):(a[0]!==E&&["object","string","number"].includes(f.v=typeof a[0])||L("item type invalid"),e&&!["string","number"].includes(f.H=typeof a[0].id)&&L("item id type invalid"));for(const l of a)l===E&&L("item is null"),typeof l!==typeof a[0]&&L("item type changed"),e&&typeof l.id!==typeof a[0].id&&L("item id type changed"),f=e?l.id:l,f in b&&L("item key not unique: "+f),b[f]=l,c.push(f);return e},ja=(a,b,c)=>{if(a.a!==E)return b.insertBefore(a.a,c),a.a;if(a.c!==E){let e=
a.b.length;do a.b[--e]!==E&&(c=ja(a.b[e],b,c));while(0<e)}return c},ka=a=>{for(;a[0][0]===E;){if(!a[0][2][5])return E;a[0][2][5]=G;a=a[0][1]}return a[0][0]},W=a=>{a=ka(a);a!==E&&(p.add(a),v||V())},la=()=>{N(E,G);const a=ka(h);a!==E&&r.add(a)},ma=(a,b)=>{N(0,G);if(k<h.length){const c=h[k++];K(c[1],b||E)||(c[2]!==E&&c[2](...c[1]),c[2]=a(...c[1]=b||[])||E)}else h[k++]=[0,b=b||[],a(...b)||E];h[k-1][2]&&h[k-1][2].then&&L("effect function must be synchronous, use hook_async instead")},na=a=>{N(2,G);if(k<
h.length)return h[k++][1];const b=h,c=[a,e=>{c[0]!==e&&(c[0]=e,W(b))},()=>c[0]];h[k++]=[2,c];return c},T=a=>{N(3,G);return(k<h.length?h[k++]:h[k++]=[3,void 0===a?{}:a])[1]},oa=(a,b)=>{N(5,G);if(k<h.length){const c=h[k++];return K(c[1],b||E)?c[2]:c[2]=a(...c[1]=b||[])}a=a(...b=b||[]);h[k++]=[5,b,a];return a},O=(a,b)=>{N(6,G);if(k<h.length){b=h[k++];const c=b[1];b[1]=a;return c}h[k++]=[6,a];return b},pa=(a,b)=>{const c=setTimeout(()=>{b(F)},a);return()=>{clearTimeout(c)}},X=a=>{const b=O(a);return g?
I(a):ha(b,a)},Y=a=>{P(a===E,"attributes presence");const b=d.a;if(a!==E){for(const c of X(a))switch(1<c.length&&c.charAt(0).toLowerCase()!==c.charAt(0)&&L("capital prop: "+c),c.charCodeAt(0)){case 70:a.F!==E&&"object"===typeof a.F||L("invalid css flags");b.className=I(a.F).filter(e=>a.F[e]).join(" ");continue;case 82:"function"!==typeof a.R&&L("invalid ref"),a.R(b);case 67:case 83:continue;default:97>c.charCodeAt(0)&&L("invalid prop: "+c),b[c]=a[c]}P(!a.S,"style presence");if(a.S)for(const c of X(a.S))b.style[c]=
a.S[c]}return b},Z=(a,b,c)=>("string"===typeof a&&L("component expected, use node_dom instead"),void 0!==c&&(!c||c.constructor!==H)&&L("invalid childs type"),{h:a,g:b?c?(b.C=c,b):b:c?{C:c}:E}),V=()=>{n=da.now();v=F;for(d of p)if(g=G,d.a!==E)R(E,E);else{let a,b=E,c=d.c,e=d,f=d;for(;(a=(e=e.j).a)===E;);do{let l=f.l;const {b:m}=f=f.j,t=m.length;for(;++l<t&&(m[l]===E||(b=m[l].c)===E););}while(b===E&&f!==e);f=d;R(a,b);if(f.c!==c)for(;(f=f.j).a===E;){c=E;for(const l of f.b)if(l!==E&&(c=l.c)!==E)break;if(c===
f.c)break;f.c=c}}v=G;d=h=E;!w&&0<r.size&&(w=F,requestAnimationFrame(qa))},qa=()=>{w=G;const a=p;p=r;(r=a).clear();V()},ra=a=>{var b=C[a];if(void 0===b){const c=a.indexOf("[");b=0>c?a.substr(0):a.substr(0,c);(0===b.length||b!==b.toLowerCase()||b.includes(" ")||b.includes("#")||b.includes("."))&&L("dom: invalid tag");C[a]=b=ca.createElement(b);if(0<c){!a.endsWith("]")&&L("dom: ] missing");for(const e of a.substring(c+1,a.length-1).split("]["))!e&&L("dom: empty attribute"),(e.includes("[")||e.includes("]"))&&
L("dom: attributes screwed up"),a=e.indexOf("="),e.includes(" ")&&(0>a||e.indexOf(" ")<a)&&L("dom: space in attribute name"),0<a?b[e.substr(0,a)]=e.substr(a+1):b[e]=F}}return b},sa=a=>{let b=D[a];if(void 0===b){const c=ra(a);D[a]=b=e=>(g&&(d.a=c.cloneNode(F)),Y(e),e!==E&&e.C||E);b.name_="$"+a}return b};J.onerror=()=>{d!==E&&console.log("lui "+fa()+": error",...[]);return p.clear(),r.clear()};J.lui={hook_assert:a=>{N(E,G);if(!a)throw C;},hook_async:(a,b,c)=>{N(1,G);const e=k<h.length?h[k++]:h[k++]=[1,E,E];if(e[1]!==E&&K(e[1],b||E))return e[2];void 0!==c&&(e[2]=c);const f=h;a(...e[1]=b=b||[]).then(l=>{e[2]!==l&&e[1]===b&&(e[2]=l,W(f))});return e[2]},hook_callback:(a,b)=>{const c=T();c.D=b;g&&(c.B=(...e)=>a(...c.D,...e));return c.B},hook_delay:a=>{const [b,c]=na(G);ma(pa,[a,c]);return b},hook_dom:(a,b)=>(N(E,F),d.a===E?g||L("hook_dom skipped before"):g&&L("hook_dom called twice"),void 0!==
b&&(void 0!==b.C&&L("hook_dom cannot have childs"),void 0!==b.R&&L("hook_dom cannot have a ref")),g&&(d.a=ra(a).cloneNode(F)),Y(b||E)),hook_effect:ma,hook_first:()=>(N(E,G),g),hook_map:(a,b,c)=>{N(4,G);var e=E;let f=F;if(k++<h.length)if((e=h[k-1])[1]!==a){for(var l of e[4])U(e[6][l]);e=E}else if(e[5]&&b===e[7]&&K(e[2],c||E))return e[3];c=c||[];e===E?h[k-1]=e=[4,a,c,[],[],F,{},b]:(f=!e[5],e[2]=c,e[3]=[],e[5]=F,e[7]=b);0===b.length&&T();l={};const m=[];b=0<b.length&&ia(b,l,m);const t=e[6],y=g,q=h,z=
k;for(var u of e[4])u in l||(U(t[u]),delete t[u]);for(const A of m){u=t[A];if(g=void 0===u)t[A]=u=[[E,q,e,E,E]];if(f||g||(b?Q(l[A],u[0][3]):l[A]!==u[0][3])){h=u;k=1;try{u[0][4]=a(u[0][3]=l[A],...c)}catch(B){if(B!==C)throw B;}h=q}e[3].push(u[0][4])}g=y;h=q;k=z;e[4]=m;return e[3]},hook_memo:oa,hook_object_changes:X,hook_prev:O,hook_reducer:a=>{N(7,G);"function"===typeof a&&L("array required, use hook_reducer_f instead");if(k<h.length)return h[k++][1];const b=h,c=[a[0](),(e,f)=>{e=a[e](c[0],f);c[0]!==
e&&(c[0]=e,W(b))}];h[k++]=[7,c];return c},hook_reducer_f:(a,b)=>{N(8,G);"function"!==typeof a&&L("function required");if(k<h.length)return h[k++][1];const c=h,e=[b?b():E,f=>{f=a(e[0],f);e[0]!==f&&(e[0]=f,W(c))}];h[k++]=[8,e];return e},hook_rerender:la,hook_state:na,hook_static:T,hook_sub:(a,b)=>{N(9,G);let c=E;if(k++<h.length)if((c=h[k-1])[1]!==a)U(c[4]),c=E;else if(c[5]&&K(c[2],b||E))return c[3];const e=g,f=h,l=k;b=b||[];(g=c===E)?(h[k-1]=c=[9,a,b,E,[],F],c[4][0]=[E,h,c]):(c[2]=b,c[5]=F);h=c[4];
k=1;try{c[3]=a(...b)}catch(m){if(m!==C)throw m;}g=e;h=f;k=l;return c[3]},hook_transition:(a,b)=>{const c=T({m:a});a=oa((e,f)=>({s:c.m,A:e,o:n,u:g?n:n+f}),[a,b]);if(a.u<=n)return c.m=a.A;la();return c.m=a.o===n?a.s:a.s+(a.A-a.s)*(n-a.o)/(a.u-a.o)},init:a=>{(d!==E||0<p.size)&&L("init called more than once");"function"!==typeof a&&L("init function requires body component");let b;const c=ca.body;c.innerHTML="";const e=()=>((!(b=a())||2!==b.length)&&L("root component must return [props, childs]"),P(b[0]===
E,"attributes presence"),b[0]!==E&&("object"!==typeof b[0]&&L("invalid props type"),M(O(b[0],b[0]),b[0]),void 0!==b[0].C&&L("body childs must be in second return value")),Y(b[0]),b[1]);e.name_="$body";d={f:{h:e,g:E},j:E,l:0,i:[],b:E,a:c,c};d.i[0]=[d];n=da.now();R(E,E);V()},node:Z,node_dom:(a,b,c)=>Z(sa(a),b,c),node_map:(a,b,c)=>Z(K,{h:a,G:b,g:c||E}),now:()=>n}}