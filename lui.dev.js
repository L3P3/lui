'use strict';/*
 lui.js web frame work 0.13.0
 inspired by react and mithril
 L3P3.de 2021
*/
{let d=null,g=!0,h=d,k=0,n=0,p=g,r=d;
const u={},w={},B=d,C=g,D=!g,E=Array,aa=Object,ba=aa.assign,F=aa.keys,ca=document,G=window,da=G.performance||Date,ea=({f:{h:a}})=>a===H?"list":a.name_||a.name||"?",fa=()=>{const a=[];let b=h;if(b!==B){for(;b[0][0]===B;)a.unshift(5===b[0].length?"hook_map:"+("object"===typeof b[0][3]?b[0][3].id:b[0][3]):"hook_sub"),b=b[0][1];b=b[0][0]}let c=B;for(;b!==B;)a.unshift(ea(b)+(c!==B?":"+c:"")),c=b.l,b=b.j;return a.join(">")||"-"},I=a=>{throw Error("lui: "+a);},J=(a,b)=>{a===b||a!==B&&b!==B&&JSON.stringify(F(a))===
JSON.stringify(F(b))||I("object keys mismatch")},K=(a,b)=>{h===B&&I("hook called outside of hook context");b&&h[0][0]===B&&I("hook called outside of component rendering");a!==B&&k<h.length&&h[k][0]!==a&&I("inconsistent hook order at #"+k)},M=(a,b)=>{K(B,D);a!==L(a,a)&&I(b+" changed between renderings")},N=new Set,P=new Set,ha=(a,b)=>(J(a,b),a===b?[]:F(a).filter(c=>a[c]!==b[c])),Q=(a,b)=>(J(a,b),a!==b&&F(a).some(c=>a[c]!==b[c])),H=(a,b)=>{b!==B?(0===b.length&&I("deps empty"),a.length!==b.length&&I("deps length changed")):
0<a.length&&I("deps presence changed");if(b!==B){let c=a.length;do if(a[--c]!==b[c])return D;while(0<c)}return C},R=(a,b)=>{const c=d,e=b;h=c.i;k=1;N.delete(c);if(c.f.h!==H){var f=B;try{f=c.f.h(c.f.g)}catch(A){if(A!==u)throw A;}var l=c.a;"object"!==typeof f&&I("components need to return child list or null");if(f!==B){l!==B&&(a=l,b=B);var m=f.length,y;"number"!==typeof m&&I("childs must be returned in a list");0===m&&I("returned childs list empty");c.b!==B&&m!==c.b.length&&I("returned childs count changed");
var t=c.b||(c.b=(new E(m)).fill(B));do{var q=t[--m];(y=f[m])&&y!==C?(q!==B&&q.f.h!==y.h&&I("child replaced at "+m),(g=q===B)?(t[m]=d=q={f:y,j:c,l:m,i:[],b:B,a:B,c:B},q.i[0]=[q],R(a,b),q.a!==B&&a.insertBefore(q.c=q.a,b)):Q(q.f.g,y.g)&&((d=q).f=y,R(a,b)),q.c!==B&&(b=q.c)):q!==B&&(S(q,a),t[m]=B)}while(0<m)}else if(c.b!==B){for(m of c.b)m!==B&&S(m,a);c.b=B}l===B&&(c.c=b!==e?b:B)}else{y=c.f.g.h;t=c.f.g.G;f=c.f.g.g;"object"===typeof t&&t!==B&&"number"===typeof t.length||I("list_data must be an array");
"object"!==typeof f&&I("props must be an object");M(y,"item component");M(f===B,"props presence");l=t.length;m={};q=[];t=0<l&&ia(t,m,q);0===l&&T();const A=T();var z=L(q),O=f===B?B:L(f);O=g||Q(f,O);if(!g)for(var v of z)v in m||(S(A[v],a),delete A[v]);for(v=c.b=new E(l);0<l;){z=q[--l];let x=A[z];if(g=void 0===x)A[z]=d=x={f:{h:y,g:f===B?{I:m[z]}:ba({I:m[z]},f)},j:c,l,i:[],b:B,a:B,c:B},x.i[0]=[x],R(a,b),x.a!==B&&a.insertBefore(x.c=x.a,b);else if(x.l!==l&&(ja(x,a,b),x.l=l),O||t&&Q(m[z],x.f.g.I))(d=x).f.g=
f===B?{I:m[z]}:ba({I:m[z]},f),R(a,b);(v[l]=x).c!==B&&(b=x.c)}c.c=b!==e?b:B}},S=(a,b)=>{b!==B&&a.a!==B&&(b.removeChild(a.a),b=B);if(a.b!==B)for(const c of a.b)c!==B&&S(c,b);U(a.i);N.delete(a);P.delete(a)},U=a=>{var b;let c=a.length;for(;1<c;)switch((b=a[--c])[0]){case 0:b[2]!==B&&b[2](...b[1]);break;case 1:b[1]=B;break;case 9:U(b[4]);break;case 4:for(const e of b[4])U(b[6][e])}},ia=(a,b,c)=>{const e="object"===typeof a[0];var f=T();f.v?(a[0]!==B&&typeof a[0]===f.v||I("item type changed"),e&&typeof a[0].id!==
f.H&&I("item id type changed")):(a[0]!==B&&["object","string","number"].includes(f.v=typeof a[0])||I("item type invalid"),e&&!["string","number"].includes(f.H=typeof a[0].id)&&I("item id type invalid"));for(const l of a)l===B&&I("item is null"),typeof l!==typeof a[0]&&I("item type changed"),e&&typeof l.id!==typeof a[0].id&&I("item id type changed"),f=e?l.id:l,f in b&&I("item key not unique: "+f),b[f]=l,c.push(f);return e},ja=(a,b,c)=>{if(a.a!==B)return b.insertBefore(a.a,c),a.a;if(a.c!==B){let e=
a.b.length;do a.b[--e]!==B&&(c=ja(a.b[e],b,c));while(0<e)}return c},ka=a=>{for(;a[0][0]===B;){if(!a[0][2][5])return B;a[0][2][5]=D;a=a[0][1]}return a[0][0]},W=a=>{a=ka(a);a!==B&&(N.add(a),p||V())},la=()=>{K(B,D);const a=ka(h);a!==B&&P.add(a)},ma=(a,b)=>{K(0,D);if(k<h.length){const c=h[k++];H(c[1],b||B)||(c[2]!==B&&c[2](...c[1]),c[2]=a(...c[1]=b||[])||B)}else h[k++]=[0,b=b||[],a(...b)||B];h[k-1][2]&&h[k-1][2].then&&I("effect function must be synchronous, use hook_async instead")},na=a=>{K(2,D);if(k<
h.length)return h[k++][1];const b=h,c=[a,e=>{c[0]!==e&&(c[0]=e,W(b))},()=>c[0]];h[k++]=[2,c];return c},T=a=>{K(3,D);return(k<h.length?h[k++]:h[k++]=[3,void 0===a?{}:a])[1]},oa=(a,b)=>{K(5,D);if(k<h.length){const c=h[k++];return H(c[1],b||B)?c[2]:c[2]=a(...c[1]=b||[])}a=a(...b=b||[]);h[k++]=[5,b,a];return a},L=(a,b)=>{K(6,D);if(k<h.length){b=h[k++];const c=b[1];b[1]=a;return c}h[k++]=[6,a];return b},pa=(a,b)=>{const c=setTimeout(()=>{b(C)},a);return()=>{clearTimeout(c)}},X=a=>{const b=L(a,B);return b===
B?F(a):ha(b,a)},Y=a=>{M(a===B,"attributes presence");const b=d.a;if(a!==B){for(const c of X(a))switch(1<c.length&&c.charAt(0).toLowerCase()!==c.charAt(0)&&I("capital prop: "+c),c.charCodeAt(0)){case 70:a.F!==B&&"object"===typeof a.F||I("invalid css flags");b.className=F(a.F).filter(e=>a.F[e]).join(" ");continue;case 82:"function"!==typeof a.R&&I("invalid ref"),a.R(b);case 67:case 83:continue;default:97>c.charCodeAt(0)&&I("invalid prop: "+c),b[c]=a[c]}M(!a.S,"style presence");if(a.S)for(const c of X(a.S))b.style[c]=
a.S[c]}return b},Z=(a,b,c)=>("string"===typeof a&&I("component expected, use node_dom instead"),void 0!==c&&(!c||c.constructor!==E)&&I("invalid childs type"),{h:a,g:b?c?(b.C=c,b):b:c?{C:c}:B}),V=()=>{g=0===n;n=da.now();p=C;r=B;for(d of N){if(d.a!==B)R(B,B);else{let a,b=B,c=d.c,e=d,f=d;for(;(a=(e=e.j).a)===B;);do{let l=f.l;const {b:m}=f=f.j,y=m.length;for(;++l<y&&(m[l]===B||(b=m[l].c)===B););}while(b===B&&f!==e);f=d;R(a,b);if(f.c!==c)for(;(f=f.j).a===B;){c=B;for(const l of f.b)if(l!==B&&(c=l.c)!==
B)break;if(c===f.c)break;f.c=c}}g=D}p=D;d=h=B;if(0<P.size){for(const a of P)N.add(a);P.clear();r===B&&(r=requestAnimationFrame(V))}},qa=a=>{var b=u[a];if(void 0===b){const c=a.indexOf("[");b=0>c?a.substr(0):a.substr(0,c);(0===b.length||b!==b.toLowerCase()||b.includes(" ")||b.includes("#")||b.includes("."))&&I("dom: invalid tag");u[a]=b=ca.createElement(b);if(0<c){!a.endsWith("]")&&I("dom: ] missing");for(const e of a.substring(c+1,a.length-1).split("]["))!e&&I("dom: empty attribute"),(e.includes("[")||
e.includes("]"))&&I("dom: attributes screwed up"),a=e.indexOf("="),e.includes(" ")&&(0>a||e.indexOf(" ")<a)&&I("dom: space in attribute name"),0<a?b[e.substr(0,a)]=e.substr(a+1):b[e]=C}}return b},ra=a=>{let b=w[a];if(void 0===b){const c=qa(a);w[a]=b=e=>(g&&(d.a=c.cloneNode(C)),Y(e),e!==B&&e.C||B);b.name_="$"+a}return b};G.onerror=()=>{d!==B&&console.log("lui "+fa()+": error",...[]);return N.clear(),P.clear()};G.lui={defer:()=>{d!==B&&I("defer while rendering");p=C;r===B&&(r=requestAnimationFrame(V))},defer_end:()=>{d!==B&&I("defer_end while rendering");p||I("nothing was deferred");cancelAnimationFrame(r);V()},hook_assert:a=>{K(B,D);if(!a)throw u;},hook_async:(a,b,c)=>{K(1,D);const e=k<h.length?h[k++]:h[k++]=[1,B,B];if(e[1]!==B&&H(e[1],b||B))return e[2];void 0!==c&&(e[2]=c);const f=h;a(...e[1]=b=b||[]).then(l=>{e[2]!==l&&e[1]===b&&(e[2]=l,W(f))});return e[2]},hook_callback:(a,b)=>{const c=T();c.D=b;return c.B||
(c.B=(...e)=>a(...c.D,...e))},hook_delay:a=>{const [b,c]=na(D);ma(pa,[a,c]);return b},hook_dom:(a,b)=>(K(B,C),d.a===B?g||I("hook_dom skipped before"):g&&I("hook_dom called twice"),void 0!==b&&(void 0!==b.C&&I("hook_dom cannot have childs"),void 0!==b.R&&I("hook_dom cannot have a ref")),g&&(d.a=qa(a).cloneNode(C)),Y(b||B)),hook_effect:ma,hook_first:()=>(K(B,D),g),hook_map:(a,b,c)=>{K(4,D);var e=B;let f=C;if(k++<h.length)if((e=h[k-1])[1]!==a){for(var l of e[4])U(e[6][l]);e=B}else if(e[5]&&H(e[2],c||
B)){if(b===e[7])return e[3];f=D}else e[2]=c,e[5]=C;c=c||[];e===B?h[k-1]=e=[4,a,c,[],[],C,{},b]:e[3]=[];0===b.length&&T();l={};const m=[],y=0<b.length&&ia(b,l,m),t=e[6],q=g,z=h,O=k;if(e[7]!==b){e[7]=b;for(const v of e[4])v in l||(U(t[v]),delete t[v])}for(const v of m){b=t[v];if(g=void 0===b)t[v]=b=[[B,z,e,B,B]];if(f||g||(y?Q(l[v],b[0][3]):l[v]!==b[0][3])){h=b;k=1;try{b[0][4]=a(b[0][3]=l[v],...c)}catch(A){if(A!==u)throw A;}h=z}e[3].push(b[0][4])}g=q;h=z;k=O;e[4]=m;return e[3]},hook_memo:oa,hook_object_changes:X,
hook_prev:L,hook_reducer:a=>{K(7,D);"function"===typeof a&&I("array required, use hook_reducer_f instead");if(k<h.length)return h[k++][1];const b=h,c=[a[0](),(e,f)=>{e=a[e](c[0],f);c[0]!==e&&(c[0]=e,W(b))}];h[k++]=[7,c];return c},hook_reducer_f:(a,b)=>{K(8,D);"function"!==typeof a&&I("function required");if(k<h.length)return h[k++][1];const c=h,e=[b?b():B,f=>{f=a(e[0],f);e[0]!==f&&(e[0]=f,W(c))}];h[k++]=[8,e];return e},hook_rerender:la,hook_state:na,hook_static:T,hook_sub:(a,b)=>{K(9,D);let c=B;if(k++<
h.length)if((c=h[k-1])[1]!==a)U(c[4]),c=B;else if(c[5]&&H(c[2],b||B))return c[3];const e=g,f=h,l=k;b=b||[];(g=c===B)?(h[k-1]=c=[9,a,b,B,[],C],c[4][0]=[B,h,c]):(c[2]=b,c[5]=C);h=c[4];k=1;try{c[3]=a(...b)}catch(m){if(m!==u)throw m;}g=e;h=f;k=l;return c[3]},hook_transition:(a,b)=>{const c=T({m:a});a=oa((e,f)=>({s:c.m,A:e,o:n,u:g?n:n+f}),[a,b]);if(a.u<=n)return c.m=a.A;la();return c.m=a.o===n?a.s:a.s+(a.A-a.s)*(n-a.o)/(a.u-a.o)},init:a=>{(d!==B||0<N.size)&&I("init called more than once");"function"!==
typeof a&&I("init function requires body component");let b;const c=ca.body;c.innerHTML="";const e=()=>((!(b=a())||2!==b.length)&&I("root component must return [props, childs]"),M(b[0]===B,"attributes presence"),b[0]!==B&&("object"!==typeof b[0]&&I("invalid props type"),J(L(b[0],b[0]),b[0]),void 0!==b[0].C&&I("body childs must be in second return value")),Y(b[0]),b[1]);e.name_="$body";(d={f:{h:e,g:B},j:B,l:0,i:[],b:B,a:c,c}).i[0]=[d];N.add(d);d=h=B;V()},node:Z,node_dom:(a,b,c)=>Z(ra(a),b,c),node_map:(a,
b,c)=>Z(H,{h:a,G:b,g:c||B}),now:()=>n}}