'use strict';/*
 lui.js web frame work 1.3.2
 inspired by react and mithril
 L3P3.de 2022
*/
{let e=null,f=!e,g=e,h=0,m=0,u=0,y=f,z=[],A=[];
const B={},aa={},ba={},ca=[],C=[],da={},D=e,F=f,G=!f,H=Array,ea=Object,fa=ea.assign,J=ea.keys,ha=document,K=window,ia=K.performance||Date,ja=({s:{v:a}})=>a===L?"list":a.name_||a.name||"?",M=()=>{const a=[];let b=g,c=D;if(b){for(a.unshift("$"+(h-1));0!==b[0].o;)a.unshift(1===b[0].o?`hook_map[${"object"===typeof b[0].O?b[0].O.id:b[0].O}]`:"hook_sub"),b=b[0].W;b=b[0].N}for(;b;)a.unshift(ja(b)+(c?":"+c:"")),c=b.L,b=b.H;return a.join("/")||"-"},ka=(...a)=>{console.log(...a)},la=a=>{ka("lui "+M()+": "+
a,...[])},N=a=>{throw Error("lui: "+a);},ma=a=>{ka("lui "+a+": error in callback")},na=(a,b,c)=>{try{return a(...b)}catch(d){throw ma(c),d;}},Q=(a,b)=>{a===b||a&&b&&JSON.stringify(J(a))===JSON.stringify(J(b))||N("object keys mismatch")},R=(a,b,c)=>{g||N("hook called outside of hook context");c&&(c.constructor!==H&&N("deps must be in an array"),0===c.length&&N("deps must not be empty"));b&&0!==g[0].o&&N("hook called outside of component rendering");a!==D&&h<g.length&&(g[h].o!==a&&N("inconsistent hook order"),
g[h].m&&oa(g[h].m,c))},T=(a,b)=>{R(D,G,D);a!==S(a,a)&&N(b+" changed between renderings")},oa=(a,b)=>{b?a.length!==b.length&&N("deps length changed"):0<a.length&&N("deps presence changed")},pa=a=>new Function("a","b",`return a!==b&&(${a.join("||")})`),L=a=>{const b=(a=J(a)).join(",");return ba[b]||(0===a.length&&N("object empty"),a.some(c=>(c.includes("-")||"0123456789".includes(c.charAt(0)))&&N("invalid key: "+c)),ba[b]=pa(a.map(c=>`a.${c}!==b.`+c)))},qa=(a,b)=>(Q(a,b),a===b?C:J(a).filter(c=>a[c]!==
b[c])),U=a=>a?ca[a.length]||(0===a.length&&N("deps must not be empty"),ca[a.length]=pa(a.map((b,c)=>`a[${c}]!==b[${c}]`))):D,V=(a,b)=>{const c=e,d=b,r=c.u+1;g=c.B;h=1;c.A=G;if(c.s.v!==L){var l=D;try{l=(0,c.s.v)(c.s.l||da)}catch(O){if(O!==B)throw O;}var p=c.g;"object"!==typeof l&&N("components need to return child list or null");if(l){p&&(a=p,b=D);var q=l.length,k;"number"!==typeof q&&N("childs must be returned in a list");0===q&&N("returned childs list empty");c.h&&q!==c.h.length&&N("returned childs count changed");
var v=c.h||(c.h=(new H(q)).fill(D));do{var n=v[--q];if((k=l[q])&&k!==F){n&&n.s.v!==k.v&&N("child component changed at "+q);if(f=!n)(v[q]=e=n={s:k,M:k.l&&L(k.l),H:c,u:r,L:q,B:[],h:D,g:D,i:D,A:G}).B[0]={o:0,N:n},V(a,b),n.g&&a.insertBefore(n.i=n.g,b);else if(Q(n.s.l,k.l),k.l&&n.M(n.s.l,k.l))(e=n).s=k,V(a,b);n.i&&(b=n.i)}else n&&(W(n,a),v[q]=D)}while(0<q)}else if(c.h){for(q of c.h)q&&W(q,a);c.h=D}p||(c.i=b!==d?b:D)}else{q=c.s.l.v;var x=c.s.l.Z;n=c.s.l.l;"object"===typeof x&&x&&x.constructor===H||N("list_data must be an array");
"object"!==typeof n&&N("props must be an object");T(q,"item component");T(n&&J(n).join(","),"common props");v=x.length;let O=F;if(!(0>=S(v,v)+v)){k=X();l={};p=[];var t;if(t=0<v){t="object"===typeof x[0];const E=X();E.U||(x[0]!==D&&["object","string","number"].includes(E.U=typeof x[0])||N("item type invalid"),t&&(!["string","number"].includes(E.$=typeof x[0].id)&&N("item id type invalid"),E.keys=J(x[0]).join(",")));for(var w of x)w===D&&N("item is null"),typeof w!==E.U&&N("item type changed"),t&&(typeof w.id!==
E.$&&N("item id type changed"),J(w).join(",")!==E.keys&&N("item keys differ of "+w.id));for(var I of x)w=t?I.id:I,w in l&&N("item key not unique: "+w),l[w]=I,p.push(w)}I=t;v||X();if(k.K){O=n&&k.M(n,k.T);for(var P of k.P)P in l||(W(k.K[P],a),delete k.K[P]);k.T=n;k.P=p}else k.K={},k.Y=I?L(l[p[0]]):D,k.P=p,k.M=(k.T=n)&&L(n);for(P=c.h=new H(v);0<v;){w=p[--v];t=k.K[w];if(f=!t)(k.K[w]=e=t={s:{v:q,l:fa({I:l[w]},n)},M:D,H:c,u:r,L:v,B:[],h:D,g:D,i:D,A:G}).B[0]={o:0,N:t},V(a,b),t.g&&a.insertBefore(t.i=t.g,
b);else if((x=ra(t))&&x.nextSibling!==b&&sa(t,a,b),O||I&&k.Y(l[w],t.s.l.I))(e=t).s.l=fa({I:l[w]},n),V(a,b);(P[t.L=v]=t).i&&(b=t.i)}c.i=b!==d?b:D}}},W=(a,b)=>{b&&a.g&&(b.removeChild(a.g),b=D);if(a.h)for(var c of a.h)c&&W(c,b);b=a.B;let d=b.length;for(;1<d;)switch((c=b[--d]).o){case 3:c.G&&c.G(...c.m);break;case 4:c.m=C}if(a.A){let r,l;(!(l=z[r=a.u])||0>(r=l.indexOf(a)))&&(!(l=A[r])||0>(r=l.indexOf(a)))||l.splice(r,1)}},ra=a=>{if(a.g)return a.g;let b;a=(b=a.h)?b.length:0;let c,d;for(;0<a;)if((d=b[--a])&&
(c=ra(d)))return c;return D},sa=(a,b,c)=>{if(a.g)return b.insertBefore(a.g,c),a.g;if(a.i){let d=a.h.length;do a.h[--d]&&(c=sa(a.h[d],b,c));while(0<d)}return c},ta=a=>{for(;0!==a[0].o;){if(!a[0].X.V)return D;a[0].X.V=G;a=a[0].W}return a[0].N},Z=a=>(a=ta(a))&&!a.A&&(a.A=F,z[a.u]?z[a.u].push(a):z[a.u]=[a],y||Y()),X=a=>(R(6,G,D),(h<g.length?g[h++]:g[h++]={o:6,j:void 0===a?{}:a}).j),S=(a,b)=>(R(9,G,D),h<g.length?(b=g[h].j,g[h++].j=a):g[h++]={o:9,j:a},b),ua=a=>{"object"===typeof a&&a||N("object required");
const b=S(a,D);return b?qa(b,a):J(a)},va=a=>{T(!a,"attributes presence");const b=e.g;if(a){for(const c of ua(a))switch(1<c.length&&c.charAt(0).toLowerCase()!==c.charAt(0)&&N("capital prop: "+c),c.charCodeAt(0)){case 70:"object"===typeof a.F&&a.F||N("invalid css flags");b.className=J(a.F).filter(d=>a.F[d]).join(" ");continue;case 82:"function"!==typeof a.R&&N("invalid ref"),a.R(b);case 67:case 68:case 83:continue;default:97>c.charCodeAt(0)&&N("invalid prop: "+c),b[c]=a[c]}T(!a.D,"dataset presence");
if(a.D)for(const c of ua(a.D))b.dataset[c]=a.D[c];T(!a.S,"style presence");if(a.S)for(const c of ua(a.S))b.style[c]=a.S[c]}return b},wa=(a,b,c)=>("string"===typeof a&&N("component expected, use node_dom instead"),c&&c.constructor!==H&&N("invalid childs type"),{v:a,l:b?c?(b.C=c,b):b:c?{C:c}:D}),Y=()=>{f=0>=m;m=ia.now();u&&cancelAnimationFrame(u);y=F;u=0;var a;let b=0;for(;(a=z).length;){10<++b&&N("rerender loop detected");z=[];for(const c of a)if(c)for(e of c)if(e.A){if(e.g)V(D,D);else{let d=D,r=e.i,
l=e,p=e;for(;!(a=(l=l.H).g););do{let q=p.L;const {h:k}=p=p.H,v=k.length;for(;++q<v&&k[q]&&!(d=k[q].i););}while(!d&&p!==l);p=e;V(a,d);if(p.i!==r)for(;!(p=p.H).g;){r=D;for(const q of p.h)if(q&&(r=q.i))break;if(r===p.i)break;p.i=r}}f=G}}y=G;e=g=D;A.length&&(z=A,A=a,xa())},xa=()=>u||(u=requestAnimationFrame(Y)),ya=a=>{var b=B[a];if(!b){const c=a.indexOf("[");b=0>c?a.substr(0):a.substr(0,c);(0===b.length||b!==b.toLowerCase()||b.includes(" ")||b.includes("#")||b.includes("."))&&N("dom: invalid tag");B[a]=
b=ha.createElement(b);if(0<c){!a.endsWith("]")&&N("dom: ] missing");for(const d of a.substring(c+1,a.length-1).split("]["))!d&&N("dom: empty attribute"),(d.includes("[")||d.includes("]"))&&N("dom: attributes screwed up"),a=d.indexOf("="),d.includes(" ")&&(0>a||d.indexOf(" ")<a)&&N("dom: space in attribute name"),0<a?b[d.substr(0,a)]=d.substr(a+1):b[d]=F}}return b},za=a=>{let b=aa[a];if(!b){const c=ya(a);aa[a]=b=d=>(f&&(e.g=c.cloneNode(F)),va(d),d&&d.C||D);b.name_="$"+a}return b};
K.onerror=()=>(e&&la("error in component"),z=A=[],G);K.lui={defer:()=>(e&&N("defer while rendering"),y=F,xa()),defer_end:()=>(e&&N("defer_end while rendering"),y||N("nothing was deferred"),Y()),hook_assert:a=>{R(D,G,D);if(!a)throw B;},hook_async:(a,b,c)=>{R(4,G,b);let d;const r=M();if((h<g.length?(d=g[h++],G):d=g[h++]={o:4,J:U(b),m:b||C,j:D})||b&&d.J(d.m,b)&&(d.m=b)){void 0!==c&&(d.j=c);const l=g;a(...d.m).then(p=>d.j!==p&&d.m===b&&(d.j=p,Z(l))).catch(p=>{ma(r);throw p;})}return d.j},hook_dom:(a,b)=>(R(D,F,D),e.g?f&&N("hook_dom called twice"):f||N("hook_dom skipped before"),
b&&(b.C&&N("hook_dom cannot have childs"),b.R&&N("hook_dom cannot have a ref")),f&&(e.g=ya(a).cloneNode(F)),va(b||D)),hook_effect:(a,b)=>{R(3,G,b);if(h>=g.length)g[h]={o:3,J:U(b),m:b=b||C,G:a(...b)||D};else if(b){const c=g[h];c.J(c.m,b)&&(c.G&&c.G(...c.m),c.G=a(...(c.m=b))||D)}g[h].G&&g[h].G.then&&N("effect function must be synchronous");++h},hook_memo:(a,b)=>(R(8,G,b),h>=g.length?(g[h++]={o:8,J:U(b),m:b=b||C,j:a(...b)}).j:b&&g[h].J(g[h].m,b)?g[h].j=a(...(g[h++].m=b)):g[h++].j),hook_model:a=>{R(10,
G,D);"object"!==typeof a&&N("mutations object required");"function"!==typeof a.init&&N("init mutation required for initial value");if(h<g.length)return g[h++].j;const b=g,c=M(),d=[(0,a.init)(D),{}];for(const r of J(a))d[1][r]=l=>{l=na(a[r],[d[0],l],c+" -> #"+r);d[0]!==l&&(d[0]=l,Z(b))};g[h++]={o:10,j:d};return d},hook_prev:S,hook_rerender:()=>{R(D,G,D);const a=ta(g);a&&(a.A=F,A[a.u]?A[a.u].push(a):A[a.u]=[a])},hook_state:a=>{R(5,G,D);if(h<g.length)return g[h++].j;const b=g,c=[a,d=>{c[0]!==d&&(c[0]=
d,Z(b))},()=>c[0]];g[h++]={o:5,j:c};return c},hook_static:X,init:a=>{(e||z.length||A.length)&&N("init called more than once");"function"!==typeof a&&N("no init function specified");let b;const c=ha.body;c.innerHTML="";const d=()=>((!(b=a())||2!==b.length)&&N("root component must return [props, childs]"),T(!b[0],"attributes presence"),b[0]!==D&&("object"!==typeof b[0]&&N("invalid props type"),Q(S(b[0],b[0]),b[0]),b[0].C&&N("root childs must be in second return value")),va(b[0]),b[1]);d.name_="$root";
(e={s:{v:d,l:D},M:D,H:D,u:0,L:0,B:[],h:D,g:c,i:c,A:F}).B[0]={o:0,N:e};z[0]=[e];e=g=D;Y()},node:wa,node_dom:(a,b,c)=>wa(za(a),b,c),node_map:(a,b,c)=>wa(L,{v:a,Z:b,l:c||D}),now:()=>m}}