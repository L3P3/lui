'use strict';/*
 lui.js web frame work 0.13.1
 inspired by react and mithril
 L3P3.de 2021
*/
{let d=null,f=!0,h=d,k=0,q=0,t=f,u=d;
const x={},y={},A=d,B=f,C=!f,D=Array,aa=Function,E=Object,ba=E.assign,G=E.keys,ca=document,H=window,da=H.performance||Date,ea=({l:{m:a}})=>a===I?"list":a.name_||a.name||"?",J=a=>{throw Error("lui: "+a);},K=(a,b)=>{a===b||a!==A&&b!==A&&JSON.stringify(G(a))===JSON.stringify(G(b))||J("object keys mismatch")},L=(a,b)=>{h===A&&J("hook called outside of hook context");b&&h[0][0]===A&&J("hook called outside of component rendering");a!==A&&k<h.length&&h[k][0]!==a&&J("inconsistent hook order at #"+k)},N=(a,
b)=>{L(A,C);a!==M(a,a)&&J(b+" changed between renderings")},O=new Set,P=new Set,fa={},Q=a=>{const b=(a=G(a)).join(",");return fa[b]||(a.some(c=>(c.includes("-")||"0123456789".includes(c.charAt(0)))&&J("invalid key: "+c)),fa[b]=new aa("a","b","return a!==b"+(0<a.length?"&&("+a.map(c=>"a."+c+"!==b."+c).join("||")+")":"")))},ha=(a,b)=>(K(a,b),a===b?[]:G(a).filter(c=>a[c]!==b[c])),I=(a,b)=>{b!==A?(0===b.length&&J("deps empty"),a.length!==b.length&&J("deps length changed")):0<a.length&&J("deps presence changed");
if(b!==A){let c=a.length;do if(a[--c]!==b[c])return C;while(0<c)}return B},R=(a,b)=>{const c=d,e=b;h=c.o;k=1;O.delete(c);if(c.l.m!==I){var g=A;try{g=c.l.m(c.l.j)}catch(v){if(v!==x)throw v;}var l=c.g;"object"!==typeof g&&J("components need to return child list or null");if(g!==A){l!==A&&(a=l,b=A);var p=g.length,m;"number"!==typeof p&&J("childs must be returned in a list");0===p&&J("returned childs list empty");c.h!==A&&p!==c.h.length&&J("returned childs count changed");var r=c.h||(c.h=(new D(p)).fill(A));
do{var n=r[--p];if((m=g[p])&&m!==B){n!==A&&n.l.m!==m.m&&J("child replaced at "+p);if(f=n===A)r[p]=d=n={l:m,v:m.j&&Q(m.j),s:c,u:p,o:[],h:A,g:A,i:A},n.o[0]=[n],R(a,b),n.g!==A&&a.insertBefore(n.i=n.g,b);else if(K(n.l.j,m.j),n.v!==A&&n.v(n.l.j,m.j))(d=n).l=m,R(a,b);n.i!==A&&(b=n.i)}else n!==A&&(S(n,a),r[p]=A)}while(0<p)}else if(c.h!==A){for(p of c.h)p!==A&&S(p,a);c.h=A}l===A&&(c.i=b!==e?b:A)}else{p=c.l.j.m;var z=c.l.j.U;n=c.l.j.j;"object"===typeof z&&z!==A&&"number"===typeof z.length||J("list_data must be an array");
"object"!==typeof n&&J("props must be an object");N(p,"item component");N(n&&G(n).join(","),"common props");r=z.length;if(0!==M(r,r)||0!==r){m=T();g={};l=[];z=0<r&&ia(z,g,l);0===r&&T();if(void 0!==m.A){m.J=n!==A&&m.v(n,m.K);for(var F of m.H)F in g||(S(m.A[F],a),delete m.A[F]);m.K=n;m.H=l}else m.A={},m.T=z?Q(g[l[0]]):A,m.H=l,m.v=(m.K=n)&&Q(n),m.J=B;for(F=c.h=new D(r);0<r;){const v=l[--r];let w=m.A[v];if(f=void 0===w)m.A[v]=d=w={l:{m:p,j:ba({I:g[v]},n)},v:A,s:c,u:r,o:[],h:A,g:A,i:A},w.o[0]=[w],R(a,
b),w.g!==A&&a.insertBefore(w.i=w.g,b);else if(w.u!==r&&(ja(w,a,b),w.u=r),m.J||z&&m.T(g[v],w.l.j.I))(d=w).l.j=ba({I:g[v]},n),R(a,b);(F[r]=w).i!==A&&(b=w.i)}c.i=b!==e?b:A}}},S=(a,b)=>{b!==A&&a.g!==A&&(b.removeChild(a.g),b=A);if(a.h!==A)for(const c of a.h)c!==A&&S(c,b);U(a.o);O.delete(a);P.delete(a)},U=a=>{var b;let c=a.length;for(;1<c;)switch((b=a[--c])[0]){case 0:b[2]!==A&&b[2](...b[1]);break;case 1:b[1]=A;break;case 9:U(b[4]);break;case 4:for(const e of b[4])U(b[6][e])}},ia=(a,b,c)=>{const e="object"===
typeof a[0],g=T();g.M||(a[0]!==A&&["object","string","number"].includes(g.M=typeof a[0])||J("item type invalid"),e&&(!["string","number"].includes(g.V=typeof a[0].id)&&J("item id type invalid"),g.keys=G(a[0]).join(",")));for(const l of a)l===A&&J("item is null"),typeof l!==g.M&&J("item type changed"),e&&(typeof l.id!==g.V&&J("item id type changed"),G(l).join(",")!==g.keys&&J("item keys differ of "+l.id));for(const l of a)a=e?l.id:l,a in b&&J("item key not unique: "+a),b[a]=l,c.push(a);return e},ja=
(a,b,c)=>{if(a.g!==A)return b.insertBefore(a.g,c),a.g;if(a.i!==A){let e=a.h.length;do a.h[--e]!==A&&(c=ja(a.h[e],b,c));while(0<e)}return c},ka=a=>{for(;a[0][0]===A;){if(!a[0][2][5])return A;a[0][2][5]=C;a=a[0][1]}return a[0][0]},W=a=>{a=ka(a);a!==A&&(O.add(a),t||V())},la=()=>{L(A,C);const a=ka(h);a!==A&&P.add(a)},ma=(a,b)=>{L(0,C);if(k<h.length){const c=h[k++];I(c[1],b||A)||(c[2]!==A&&c[2](...c[1]),c[2]=a(...(c[1]=b||[]))||A)}else h[k++]=[0,b=b||[],a(...b)||A];h[k-1][2]&&h[k-1][2].then&&J("effect function must be synchronous, use hook_async instead")},
na=a=>{L(2,C);if(k<h.length)return h[k++][1];const b=h,c=[a,e=>{c[0]!==e&&(c[0]=e,W(b))},()=>c[0]];h[k++]=[2,c];return c},T=a=>{L(3,C);return(k<h.length?h[k++]:h[k++]=[3,void 0===a?{}:a])[1]},oa=(a,b)=>{L(5,C);if(k<h.length){const c=h[k++];return I(c[1],b||A)?c[2]:c[2]=a(...(c[1]=b||[]))}a=a(...(b=b||[]));h[k++]=[5,b,a];return a},M=(a,b)=>{L(6,C);if(k<h.length){b=h[k++];const c=b[1];b[1]=a;return c}h[k++]=[6,a];return b},pa=(a,b)=>{const c=setTimeout(()=>{b(B)},a);return()=>{clearTimeout(c)}},X=a=>
{const b=M(a,A);return b===A?G(a):ha(b,a)},Y=a=>{N(a===A,"attributes presence");const b=d.g;if(a!==A){for(const c of X(a))switch(1<c.length&&c.charAt(0).toLowerCase()!==c.charAt(0)&&J("capital prop: "+c),c.charCodeAt(0)){case 70:a.F!==A&&"object"===typeof a.F||J("invalid css flags");b.className=G(a.F).filter(e=>a.F[e]).join(" ");continue;case 82:"function"!==typeof a.R&&J("invalid ref"),a.R(b);case 67:case 83:continue;default:97>c.charCodeAt(0)&&J("invalid prop: "+c),b[c]=a[c]}N(!a.S,"style presence");
if(a.S)for(const c of X(a.S))b.style[c]=a.S[c]}return b},Z=(a,b,c)=>("string"===typeof a&&J("component expected, use node_dom instead"),void 0!==c&&(!c||c.constructor!==D)&&J("invalid childs type"),{m:a,j:b?c?(b.C=c,b):b:c?{C:c}:A}),V=()=>{f=0===q;q=da.now();t=B;u=A;for(d of O){if(d.g!==A)R(A,A);else{let a,b=A,c=d.i,e=d,g=d;for(;(a=(e=e.s).g)===A;);do{let l=g.u;const {h:p}=g=g.s,m=p.length;for(;++l<m&&(p[l]===A||(b=p[l].i)===A););}while(b===A&&g!==e);g=d;R(a,b);if(g.i!==c)for(;(g=g.s).g===A;){c=A;
for(const l of g.h)if(l!==A&&(c=l.i)!==A)break;if(c===g.i)break;g.i=c}}f=C}t=C;d=h=A;if(0<P.size){for(const a of P)O.add(a);P.clear();u===A&&(u=requestAnimationFrame(V))}},qa=a=>{var b=x[a];if(void 0===b){const c=a.indexOf("[");b=0>c?a.substr(0):a.substr(0,c);(0===b.length||b!==b.toLowerCase()||b.includes(" ")||b.includes("#")||b.includes("."))&&J("dom: invalid tag");x[a]=b=ca.createElement(b);if(0<c){!a.endsWith("]")&&J("dom: ] missing");for(const e of a.substring(c+1,a.length-1).split("]["))!e&&
J("dom: empty attribute"),(e.includes("[")||e.includes("]"))&&J("dom: attributes screwed up"),a=e.indexOf("="),e.includes(" ")&&(0>a||e.indexOf(" ")<a)&&J("dom: space in attribute name"),0<a?b[e.substr(0,a)]=e.substr(a+1):b[e]=B}}return b},ra=a=>{let b=y[a];if(void 0===b){const c=qa(a);y[a]=b=e=>(f&&(d.g=c.cloneNode(B)),Y(e),e!==A&&e.C||A);b.name_="$"+a}return b};
H.onerror=()=>{if(d!==A){var a=console,b=a.log;const c=[];let e=h;if(e!==A){for(;e[0][0]===A;)c.unshift(5===e[0].length?"hook_map:"+("object"===typeof e[0][3]?e[0][3].id:e[0][3]):"hook_sub"),e=e[0][1];e=e[0][0]}let g=A;for(;e!==A;)c.unshift(ea(e)+(g!==A?":"+g:"")),g=e.u,e=e.s;b.call(a,"lui "+(c.join(">")||"-")+": error",...[])}return O.clear(),P.clear()};H.lui={defer:()=>{d!==A&&J("defer while rendering");t=B;u===A&&(u=requestAnimationFrame(V))},defer_end:()=>{d!==A&&J("defer_end while rendering");t||J("nothing was deferred");cancelAnimationFrame(u);V()},hook_assert:a=>{L(A,C);if(!a)throw x;},hook_async:(a,b,c)=>{L(1,C);const e=k<h.length?h[k++]:h[k++]=[1,A,A];if(e[1]!==A&&I(e[1],b||A))return e[2];void 0!==c&&(e[2]=c);const g=h;a(...(e[1]=b=b||[])).then(l=>{e[2]!==l&&e[1]===b&&(e[2]=l,W(g))});return e[2]},hook_callback:(a,b)=>{const c=T();c.P=b;return c.O||
(c.O=(...e)=>a(...c.P,...e))},hook_delay:a=>{const [b,c]=na(C);ma(pa,[a,c]);return b},hook_dom:(a,b)=>(L(A,B),d.g===A?f||J("hook_dom skipped before"):f&&J("hook_dom called twice"),void 0!==b&&(void 0!==b.C&&J("hook_dom cannot have childs"),void 0!==b.R&&J("hook_dom cannot have a ref")),f&&(d.g=qa(a).cloneNode(B)),Y(b||A)),hook_effect:ma,hook_first:()=>(L(A,C),f),hook_map:(a,b,c)=>{L(4,C);var e=A;let g=B;if(k++<h.length)if((e=h[k-1])[1]!==a){for(var l of e[4])U(e[6][l]);e=A}else if(e[5]&&I(e[2],c||
A)){if(b===e[7])return e[3];g=C}else e[2]=c,e[5]=B;c=c||[];e===A?h[k-1]=e=[4,a,c,[],[],B,{},b,A]:e[3]=[];0===b.length&&T();l={};const p=[],m=0<b.length&&ia(b,l,p),r=e[6],n=f,z=h,F=k;m&&e[8]===A&&(e[8]=Q(b[0]));if(e[7]!==b){e[7]=b;for(const v of e[4])v in l||(U(r[v]),delete r[v])}for(const v of p){b=r[v];if(f=void 0===b)r[v]=b=[[A,z,e,A,A]];if(g||f||(m?e[8](l[v],b[0][3]):l[v]!==b[0][3])){h=b;k=1;try{b[0][4]=a(b[0][3]=l[v],...c)}catch(w){if(w!==x)throw w;}h=z}e[3].push(b[0][4])}f=n;h=z;k=F;e[4]=p;return e[3]},
hook_memo:oa,hook_object_changes:X,hook_prev:M,hook_reducer:a=>{L(7,C);"function"===typeof a&&J("array required, use hook_reducer_f instead");if(k<h.length)return h[k++][1];const b=h,c=[a[0](),(e,g)=>{e=a[e](c[0],g);c[0]!==e&&(c[0]=e,W(b))}];h[k++]=[7,c];return c},hook_reducer_f:(a,b)=>{L(8,C);"function"!==typeof a&&J("function required");if(k<h.length)return h[k++][1];const c=h,e=[b?b():A,g=>{g=a(e[0],g);e[0]!==g&&(e[0]=g,W(c))}];h[k++]=[8,e];return e},hook_rerender:la,hook_state:na,hook_static:T,
hook_sub:(a,b)=>{L(9,C);let c=A;if(k++<h.length)if((c=h[k-1])[1]!==a)U(c[4]),c=A;else if(c[5]&&I(c[2],b||A))return c[3];const e=f,g=h,l=k;b=b||[];(f=c===A)?(h[k-1]=c=[9,a,b,A,[],B],c[4][0]=[A,h,c]):(c[2]=b,c[5]=B);h=c[4];k=1;try{c[3]=a(...b)}catch(p){if(p!==x)throw p;}f=e;h=g;k=l;return c[3]},hook_transition:(a,b)=>{const c=T({B:a});a=oa((e,g)=>({G:c.B,N:e,D:q,L:f?q:q+g}),[a,b]);if(a.L<=q)return c.B=a.N;la();return c.B=a.D===q?a.G:a.G+(a.N-a.G)*(q-a.D)/(a.L-a.D)},init:a=>{(d!==A||0<O.size)&&J("init called more than once");
"function"!==typeof a&&J("init function requires body component");let b;const c=ca.body;c.innerHTML="";const e=()=>((!(b=a())||2!==b.length)&&J("root component must return [props, childs]"),N(b[0]===A,"attributes presence"),b[0]!==A&&("object"!==typeof b[0]&&J("invalid props type"),K(M(b[0],b[0]),b[0]),void 0!==b[0].C&&J("body childs must be in second return value")),Y(b[0]),b[1]);e.name_="$body";(d={l:{m:e,j:A},v:A,s:A,u:0,o:[],h:A,g:c,i:c}).o[0]=[d];O.add(d);d=h=A;V()},node:Z,node_dom:(a,b,c)=>
Z(ra(a),b,c),node_map:(a,b,c)=>Z(I,{m:a,U:b,j:c||A}),now:()=>q}}