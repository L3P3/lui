"use strict";/*
 lui.js web framework 2.2.1
 inspired by react and mithril
 l3p3.de 2025
*/
(function(){function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function e(a){var b=typeof Symbol!="undefined"&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if(typeof a.length=="number")return{next:aa(a)};throw Error(String(a)+" is not an iterable or ArrayLike");}function f(a){if(!(a instanceof Array)){a=e(a);for(var b,c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}
function l(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b};var m=null,n=!m,x=m,y=0,z=0,B=0,C=!n,D=[],E=[],F={},ba={},ca={},da=[],G=[],ea={},H=m,I=n,K=C,fa=/[A-Z]/g,L=Array,M=Object,N=M.assign,O=M.keys,ha=M.freeze||function(a){return a},ia=M.isFrozen||function(a){return a===H||typeof a!=="object"},ja=document,ka=window,la=ka.performance||Date;
function P(a){return a===void 0&&Q("model state must not contain undefined, missing return?"),ia(a)||(ha(a).constructor!==L&&(a.constructor!==M&&Q("model state must not contain shit like "+a.constructor.name),a=M.values(a)),a.forEach(P))}function ma(a){a=a.o.v;return a===S?"list":a.name_||a.name||"?"}function na(){var a=[],b=m,c=H;for(m&&(a[0]="$"+y);b;)a.unshift(ma(b)+(c!==H?":"+c:"")),c=b.M,b=b.G;return a.join("/")||"-"}function oa(){console.log.apply(console,f(l.apply(0,arguments)))}
function pa(a){var b=l.apply(1,arguments);oa.apply(null,["lui "+na()+": "+a].concat(f(b)))}function Q(a){throw Error("lui: "+a);}function qa(a){oa("lui "+a+": error in callback");m=H}function T(a,b,c){try{return a.apply(null,f(b))}catch(d){throw qa(c),d;}}function sa(a,b){a===b||a&&b&&JSON.stringify(O(a))===JSON.stringify(O(b))||Q("object keys mismatch")}
function U(a,b){x||Q("hook called outside of hook context");b&&(b.constructor!==L&&Q("deps must be in an array"),b.length===0&&Q("deps must not be empty"));a!==H&&y<x.length&&(x[y].B!==a&&Q("inconsistent hook order"),x[y].l&&ta(x[y].l,b))}function V(a,b){U(H,H);a!==W(a,a)&&Q(b+" changed between renderings")}function ta(a,b){b?a.length!==b.length&&Q("deps length changed"):a.length>0&&Q("deps presence changed")}function ua(a){return new Function("a","b","return a!==b&&("+a.join("||")+")")}
function va(a){var b=(a=O(a)).join(",");return ca[b]||(a.length===0&&Q("object empty"),a.some(function(c){return(c.includes("-")||"0123456789".includes(c.charAt(0)))&&Q("invalid key: "+c)}),ca[b]=ua(a.map(function(c){return"a."+c+"!==b."+c})))}function wa(a,b){return sa(a,b),a===b?G:O(a).filter(function(c){return a[c]!==b[c]})}function xa(a){return a?(a.length===0&&Q("deps must not be empty"),da[a.length]||(da[a.length]=ua(a.map(function(b,c){return"a["+c+"]!==b["+c+"]"})))):H}
function S(a,b){var c=m,d=b,q=c.u+1;x=c.O;y=0;c.A=K;if(c.o.v!==S){var g=H;try{g=(0,c.o.v)(c.o.m||ea)}catch(ra){if(ra!==F)throw ra;}var r=c.g;typeof g!=="object"&&Q("components need to return child list or null");if(g){r&&(a=r,b=H);var h=g.length,k;typeof h!=="number"&&Q("childs must be returned in a list");h===0&&Q("returned childs list empty");c.h&&h!==c.h.length&&Q("returned childs count changed");var w=c.h||(c.h=(new L(h)).fill(H));do{var t=w[--h];if((k=g[h])&&k!==I){m.u===0&&k.length!=H&&Q("root component signature changed, see https://github.com/L3P3/lui/issues/53");
!k.v&&Q("invalid node type at "+h);t&&t.o.v!==k.v&&Q("node type changed at "+h);if(n=!t)w[h]=m=t={o:k,N:k.m&&va(k.m),G:c,u:q,M:h,O:[],h:H,g:H,i:H,A:K},S(a,b),t.g&&a.insertBefore(t.i=t.g,b);else if(sa(t.o.m,k.m),k.m&&t.N(t.o.m,k.m))(m=t).o=k,S(a,b);t.i&&(b=t.i)}else t&&(X(t,a),w[h]=H)}while(h>0)}else if(c.h){q=e(c.h);for(g=q.next();!g.done;g=q.next())(g=g.value)&&X(g,a);c.h=H}r||(c.i=b!==d?b:H)}else{g=c.o.m;r=g.v;var v=g.W;g=g.m;typeof v==="object"&&v&&v.constructor===L||Q("list_data must be an array");
typeof g!=="object"&&Q("props must be an object");V(r,"item component");V(g&&O(g).join(","),"common props");h=v.length;t=I;if(!(W(h,h)+h<=0)){k=Y();w={};var R=[],J;if(J=h>0){J=typeof v[0]==="object";var p=Y();p.U||(v[0]!==H&&["object","string","number"].includes(p.U=typeof v[0])||Q("item type invalid"),J&&(!["string","number"].includes(p.X=typeof v[0].id)&&Q("item id type invalid"),p.keys=O(v[0]).join(",")));for(var u=e(v),A=u.next();!A.done;A=u.next())A=A.value,A===H&&Q("item is null"),typeof A!==
p.U&&Q("item type changed"),J&&(typeof A.id!==p.X&&Q("item id type changed"),O(A).join(",")!==p.keys&&Q("item keys differ of "+A.id));v=e(v);for(p=v.next();!p.done;p=v.next())p=p.value,u=J?p.id:p,u in w&&Q("item key not unique: "+u),w[u]=p,R.push(u)}h||Y();if(k.K){t=g&&k.N(g,k.T);v=e(k.P);for(p=v.next();!p.done;p=v.next())p=p.value,p in w||(X(k.K[p],a),delete k.K[p]);k.T=g;k.P=R}else k.K={},k.V=J?va(w[R[0]]):H,k.P=R,k.N=(k.T=g)&&va(g);for(v=c.h=new L(h);h>0;){p=R[--h];u=k.K[p];if(n=!u)k.K[p]=m=u=
{o:{v:r,m:N({I:w[p]},g)},N:H,G:c,u:q,M:h,O:[],h:H,g:H,i:H,A:K},S(a,b),u.g&&a.insertBefore(u.i=u.g,b);else if((A=ya(u))&&A.nextSibling!==b&&za(u,a,b),t||J&&k.V(w[p],u.o.m.I))(m=u).o.m=N({I:w[p]},g),S(a,b);(v[u.M=h]=u).i&&(b=u.i)}c.i=b!==d?b:H}}}
function X(a,b){b&&a.g&&(b.removeChild(a.g),b=H);if(a.h)for(var c=e(a.h),d=c.next();!d.done;d=c.next())(d=d.value)&&X(d,b);b=a.O;for(d=b.length;d>1;)switch((c=b[--d]).B){case 3:c.H&&c.H.apply(c,f(c.l));break;case 4:c.l=G}if(a.A){var q,g;(!(g=D[q=a.u])||(q=g.indexOf(a))<0)&&(!(g=E[q])||(q=g.indexOf(a))<0)||g.splice(q,1)}}function ya(a){if(a.g)return a.g;var b;a=(b=a.h)?b.length:0;for(var c,d;a>0;)if((d=b[--a])&&(c=ya(d)))return c;return H}
function za(a,b,c){if(a.g)return b.insertBefore(a.g,c);if(a.i){var d=a.h.length;do a.h[--d]&&(c=za(a.h[d],b,c));while(d>0)}return c}function Z(a){return!a.A&&(a.A=I,D[a.u]?D[a.u].push(a):D[a.u]=[a],C||Aa())}function Y(a){return U(6,H),(y<x.length?x[y++]:x[y++]={B:6,j:a===void 0?{}:a}).j}function W(a,b){return U(9,H),y<x.length?(b=x[y].j,x[y++].j=a):x[y++]={B:9,j:a},b}function Ba(a){typeof a==="object"&&a||Q("object required");var b=W(a,H);return b?wa(b,a):O(a)}
function Ca(a){V(!a,"attributes presence");var b=m.g;if(a){for(var c=e(Ba(a)),d=c.next();!d.done;d=c.next()){d=d.value;d.length>1&&d.charAt(0).toLowerCase()!==d.charAt(0)&&Q("capital prop: "+d);switch(d.charCodeAt(0)){case 70:typeof a.F==="object"&&a.F||Q("invalid css flags");b.className=O(a.F).filter(function(q){return a.F[q]}).join(" ");continue;case 82:typeof a.R!=="function"&&Q("invalid ref"),a.R(b);case 67:case 68:case 83:continue}d.charCodeAt(0)<97&&Q("invalid prop: "+d);b[d]=a[d]}V(!a.D,"dataset presence");
if(a.D)for(c=e(Ba(a.D)),d=c.next();!d.done;d=c.next())d=d.value,b.setAttribute("data-"+d.replace(fa,"-$&").toLowerCase(),a.D[d]);V(!a.S,"style presence");if(a.S)for(c=e(Ba(a.S)),d=c.next();!d.done;d=c.next())d=d.value,b.style[d]=a.S[d]}return b}function Da(a,b,c){return typeof a==="string"&&Q("component expected, use node_dom instead"),c&&c.constructor!==L&&Q("invalid childs type"),{v:a,m:b?c?(b.C=c,b):b:c?{C:c}:H}}
function Aa(){n=z<=0;z=la.now();B&&cancelAnimationFrame(B);C=I;B=0;for(var a,b=0;(a=D).length;){++b>10&&Q("rerender loop detected");D=[];a=e(a);for(var c=a.next();!c.done;c=a.next())if(c=c.value){c=e(c);for(var d=c.next();!d.done;d=c.next())if(m=d.value,m.A){if(m.g)S(H,H);else{var q,g=H;d=m.i;for(var r=m,h=m;!(q=(r=r.G).g););do for(var k=h.M,w=(h=h.G).h,t=w.length;++k<t&&w[k]&&!(g=w[k].i););while(!g&&h!==r);h=m;S(q,g);if(h.i!==d)for(;!(h=h.G).g;){d=H;q=e(h.h);for(g=q.next();!(g.done||(g=g.value)&&
(d=g.i));g=q.next());if(d===h.i)break;h.i=d}}n=K}}}C=K;m=x=H;E.length&&(D=E,E=a,Ea())}function Ea(){return B||(B=requestAnimationFrame(Aa))}
function Fa(a){var b=F[a];if(!b){a.startsWith("#")&&Q("dom: unknown handle");var c=a.indexOf("[");b=c<0?a:a.substr(0,c);(b.length===0||b!==b.toLowerCase()||b.includes(" ")||b.includes("#")||b.includes("."))&&Q("dom: invalid tag");F[a]=b=ja.createElement(b);if(c>0)for(!a.endsWith("]")&&Q("dom: ] missing"),a=e(a.substring(c+1,a.length-1).split("][")),c=a.next();!c.done;c=a.next()){c=c.value;!c&&Q("dom: empty attribute");(c.includes("[")||c.includes("]"))&&Q("dom: attributes screwed up");var d=c.indexOf("=");
c.includes(" ")&&(d<0||c.indexOf(" ")<d)&&Q("dom: space in attribute name");d>0?b[c.substr(0,d)]=c.substr(d+1):b[c]=I}}return b}function Ga(a){a&&typeof a==="string"||Q("dom: descriptor string expected");var b=ba[a];if(!b){var c=Fa(a);ba[a]=b=function(d){return n&&(m.g=c.cloneNode(I)),Ca(d),d&&d.C||H};b.name_="$"+a}return b}ka.onerror=function(){return m&&pa("error in component"),D=E=[],K};var Ha=L.prototype;Ha.fill||(Ha.fill=function(a){for(var b=this.length,c=0;c<b;++c)this[c]=a;return this});define({defer:function(){return m&&Q("defer while rendering"),C=I,Ea()},defer_end:function(){return m&&Q("defer_end while rendering"),C||Q("nothing was deferred"),Aa()},dom_define:function(a,b,c){F["#"+a]&&Q("dom_define: handle exists");b=Fa(b);c&&(c&&(c.C&&Q("dom_define cannot have childs"),c.R&&Q("dom_define cannot have a ref")),b=b.cloneNode(I),c.D&&(N(b.dataset,c.D),delete c.D),c.S&&(N(b.style,c.S),delete c.S),N(b,c));F["#"+a]=b},hook_assert:function(a){U(H,H);if(!a)throw F;},hook_async:function(a,
b,c){U(4,b);var d,q=na();if((y<x.length?(d=x[y++],K):d=x[y++]={B:4,J:xa(b),l:b||G,j:H})||b&&d.J(d.l,b)&&(d.l=b)){c!==void 0&&(d.j=c);var g=m;a.apply(null,f(d.l)).then(function(r){return d.j!==r&&d.l===b&&(d.j=r,Z(g))}).catch(function(r){qa(q);throw r;})}return d.j},hook_dom:function(a,b){return U(H,H),m.g?n&&m.G&&Q("hook_dom called twice"):n||Q("hook_dom skipped before"),b&&(b.C&&Q("hook_dom cannot have childs"),b.R&&Q("hook_dom cannot have a ref")),m.g===H&&(m.g=Fa(a).cloneNode(I)),Ca(b||H)},hook_effect:function(a,
b){U(3,b);if(y>=x.length)x[y]={B:3,J:xa(b),l:b=b||G,H:a.apply(null,f(b))||H};else if(b){var c=x[y];c.J(c.l,b)&&(c.H&&c.H.apply(c,f(c.l)),c.H=a.apply(null,f(c.l=b))||H)}var d;((d=x[y].H)==null?0:d.then)&&Q("effect function must be synchronous");++y},hook_memo:function(a,b){return U(8,b),y>=x.length?(x[y++]={B:8,J:xa(b),l:b=b||G,j:a.apply(null,f(b))}).j:b&&x[y].J(x[y].l,b)?x[y].j=a.apply(null,f(x[y++].l=b)):x[y++].j},hook_model:function(a){U(10,H);typeof a==="object"&&a||Q("mutations object required");
typeof a.init!=="function"&&Q("init mutation required for initial value");if(y<x.length)return x[y++].j;var b=m,c=na(),d=[T(a.init,[H],c+" -> #init"),{}];T(P,[d[0]],c+" -> #init");for(var q=e(O(a)),g=q.next(),r={};!g.done;r={L:void 0},g=q.next())r.L=g.value,d[1][r.L]=function(h){return function(){var k=T(a[h.L],[d[0]].concat(f(l.apply(0,arguments))),c+" -> #"+h.L);d[0]!==k&&(T(P,[k],c+" -> #"+h.L),d[0]=k,Z(b))}}(r);x[y++]={B:10,j:d};return d},hook_prev:W,hook_rerender:function(){U(H,H);var a=m;a.A=
I;E[a.u]?E[a.u].push(a):E[a.u]=[a]},hook_state:function(a){U(5,H);if(y<x.length)return x[y++].j;var b=m,c=[a,function(d){c[0]!==d&&(c[0]=d,Z(b))},function(){return c[0]}];x[y++]={B:5,j:c};return c},hook_static:Y,init:function(a,b,c){b=b===void 0?ja.body:b;c=c===void 0?H:c;typeof a!=="function"&&Q("no init function specified");b.innerHTML!=H||Q("invalid component_ element");b._lui_used&&Q("root element already mounted");b._lui_used=1;b.innerHTML="";b={o:{v:a,m:c},N:H,G:H,u:0,M:0,O:[],h:H,g:b,i:b,A:K};
a.name_="$root";m=x=H;Z(b)},node:Da,node_dom:function(a,b,c){return Da(Ga(a),b,c)},node_map:function(a,b,c){return Da(S,{v:a,W:b,m:c||H})},now:function(){return z}})})()
